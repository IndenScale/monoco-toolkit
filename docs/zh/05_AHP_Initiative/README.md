# Agent Harness Protocol (AHP)

## 摘要

自主智能体（Autonomous Agents）在软件工程任务中的应用面临三个结构性约束：产物形式化验证的不可行性、质量保障的经济性要求，以及过程可观测性的缺失。本文提出**Agent Harness Protocol (AHP)**，一种面向自主智能体执行过程的干预框架。AHP 通过建立连续控制光谱（Control Spectrum）、过程信号系统（Signal System）和结构化工作单元描述（Issue Ticket Schema），试图在保持智能体自主性的同时，实现从"阻止"到"赋能"的渐进式质量保障。

**关键词**：自主智能体、过程干预、质量保障、可观测性、人机协作

---

## 1. 引言

### 1.1 背景

近年来，大型语言模型（LLM）驱动的自主智能体在软件工程任务中展现出显著潜力。这些智能体能够执行代码生成、重构、调试等复杂任务，其执行轨迹通常涉及多步骤决策和工具调用（Claude Code, Gemini CLI, AutoGPT 等）。

然而，将这些智能体部署于生产环境时，质量保障成为核心挑战。传统软件工程依赖形式化验证和自动化测试确保正确性，但对于智能体生成的代码和决策，这些手段面临根本性限制。

### 1.2 文档结构

本文档按以下结构组织：

| 章节 | 内容 |
|------|------|
| [01. 问题定义与动机](./01_Motivation.md) | 三约束分析：验证可行性、经济约束、可观测性 |
| [02. 记录系统](./02_Record_System.md) | Issue Ticket 的结构化定义与生命周期 |
| [03. 智能体集成](./03_Agent_Integration/) | AGENTS.md、Hooks、Skills 三机制详解 |
| &nbsp;&nbsp;&nbsp;&nbsp;[3.1 AGENTS.md](./03_Agent_Integration/01_AGENTS_md.md) | 上下文配置机制详解 |
| &nbsp;&nbsp;&nbsp;&nbsp;[3.2 Agent Hooks](./03_Agent_Integration/02_Agent_Hooks.md) | 过程干预与触发器系统 |
| &nbsp;&nbsp;&nbsp;&nbsp;[3.3 Agent Skills](./03_Agent_Integration/03_Agent_Skills.md) | 能力扩展与工具包 |
| [04. 控制协议](./04_Control_Protocol.md) | 连续控制光谱与信号系统 |

---

## 2. 核心概念

### 2.1 连续控制光谱（Control Spectrum）

AHP 的核心观察是：智能体控制不应是二元的（允许/拒绝），而应是一个从"阻止"（Blocking）到"赋能"（Aiding）的连续光谱。

```
Blocking ◄──────────────────────────────────────► Aiding
  阻拦              控制              提示              帮助
   │                │                │                │
   ▼                ▼                ▼                ▼
 拒绝操作       限制选项        提醒风险        建议最佳
                                   │            实践/复盘
                              pre-event        post-event
                               (info)           (guide)
```

详见：[04. 控制协议](./04_Control_Protocol.md)

### 2.2 过程信号（Signal）

Signal 是 AHP 中的基本通信单元，携带控制强度信息，在智能体执行过程中的关键时点被生成和消费。

```
┌─────────────────────────────────────────────────────────┐
│                      Signal                             │
├──────────────┬────────────────┬─────────────────────────┤
│   Source     │   Intensity    │      Payload            │
│   (来源)     │   (强度)       │      (载荷)             │
├──────────────┼────────────────┼─────────────────────────┤
│ • pre-event  │ • block        │ • decision              │
│ • post-event │ • control      │ • message               │
│ • periodic   │ • prompt       │ • suggestions           │
│              │ • aid          │ • context               │
└──────────────┴────────────────┴─────────────────────────┘
```

详见：[04. 控制协议](./04_Control_Protocol.md)

### 2.3 结构化工作单元（Issue Ticket）

Issue Ticket 定义了智能体工作的边界、验收标准和完成定义，是 Signal 的上下文载体。

详见：[02. 记录系统](./02_Record_System.md)

### 2.4 智能体集成三机制

AHP 通过三种机制实现与智能体的集成：

| 机制 | 作用 | 类比 |
|------|------|------|
| **AGENTS.md** | 定义规则与上下文 | 宪法/用户手册 |
| **Agent Hooks** | 关键点验证与引导 | 交通信号灯 |
| **Agent Skills** | 扩展能力工具包 | 工具箱 |

详见：[03. 智能体集成](./03_Agent_Integration/)

---

## 3. 与 Monoco 的关系

AHP 是一个**概念框架**（Conceptual Framework），Monoco 是其**参考实现**（Reference Implementation）。

```
┌─────────────────────────────────────────────────────────────┐
│                         AHP 概念层                           │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │   Control   │  │   Signal    │  │   Issue Ticket      │  │
│  │   Spectrum  │  │   System    │  │   Schema            │  │
│  └──────┬──────┘  └──────┬──────┘  └──────────┬──────────┘  │
│         │                │                    │             │
│         └────────────────┴────────────────────┘             │
│                          │                                  │
│                    AHP Protocol                            │
└──────────────────────────┬──────────────────────────────────┘
                           │
                           ▼ 实例化
┌─────────────────────────────────────────────────────────────┐
│                      Monoco 实现层                           │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │   Hooks     │  │   Issue     │  │   Skills/           │  │
│  │   System    │  │   Lifecycle │  │   AGENTS.md         │  │
│  └─────────────┘  └─────────────┘  └─────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

---

## 4. 状态与范围

**当前状态**：概念框架（Conceptual Framework）

**范围边界**：
- AHP 定义**协议规范**，不绑定特定实现
- AHP 关注**单智能体**执行过程，不涉及多智能体协调
- AHP 假设智能体具备**工具调用能力**和**环境感知能力**

---

## 参考

- 存档文档：[.archive/](./.archive/)
