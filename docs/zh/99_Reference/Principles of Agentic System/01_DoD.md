# 01. 状态证明（Definition of Done）

## 1. 从主观意图到物理断言

在传统的软件工程中，“完成”通常是一个模糊的人机博弈过程。开发者根据对需求的理解提交代码，而测试人员或代码审查者则根据主观经验给出判断。这种基于人类理解的非正式协议在智能体系统中是无法接受的，因为它缺乏计算层面的确定性。

智能体系统要求将主观的任务目标转化为“原子化的物理断言”。这种转化过程被称为状态证明（State Proof），其核心工具是“完成定义”（Definition of Done, DoD）。DoD 不是一段描述性的文字，而是一组预定义的、可由机器自动判定的测试集合或逻辑约束。只有当运行环境中的所有物理状态（如文件内容、编译结果、测试输出）完全符合这些断言时，系统才会承认任务状态的变更。

这种转变意味着，智能体的目标不再是“取悦人类”，而是“满足物理规律”。当智能体修改了一段代码，它必须通过预设的静态代码检查（Linter）以证明其语法合法性，通过单元测试（Unit Testing）以证明其行为正确性，甚至通过形式化验证以证明其逻辑严格性。

## 2. DoD 的分层结构

一个健壮的智能体系统通常通过三个递进的层次来实施其 DoD 协议：

### 2.1 结构不变量（Structural Invariants）

这是最基础的 DoD 层次，关注产物的形态完整性。例如，在一个标准化项目中，任务描述文件必须符合特定的 YAML Schema，所有的源代码必须符合特定的缩进和规范（Linting）。如果结构不变量无法满足，系统将直接拒绝后续的所有逻辑推理。这类似于编译器对程序语法错误的第一道拦截。

### 2.2 行为断言（Behavioral Assertions）

这一层关注功能的实现质量。它主要体现为自动化测试脚本。对于一个自主系统而言，测试不仅仅是事后的检查，更是事前的约束。在任务启动前定义的测试案例构成了智能体必须收敛到的目标态。通过这种方式，模糊的自然语言需求被锚定在了具体的代码路径和预期输出上。

### 2.3 领域治理准则（Domain Governance）

这是最高层次的 DoD，涉及系统性的架构约束。例如，“不允许引入新的外部库”、“核心逻辑必须具有 100% 的分支覆盖率”或“文档必须同步更新”。这些准则确保了单次任务的增量变更不会通过累积熵增而缓慢破坏整个系统的健壮性。

## 3. 作为终止条件的证明

在自主运行周期（Session）中，DoD 扮演着逻辑执行终点的角色。与对话机器人不同，智能体系统不会在生成一段文本后停下来询问“您是否满意”，而是会循环执行“生成内容——应用 DoD 检查——获取错误反馈——修正内容”的过程。

只有当所有的 DoD 条目均返回 True 时，Session 才会触发其退出信号并向人类发出合并请求。这种机制确保了交付给人类审查的产物已经过了一层严密的“物理过滤”。如果 DoD 定义得足够完备，人类的审查工作将从繁重的“寻找错误”转变为高效率的“确认设计方向”，从而极大地释放生产力。

## 4. 证明的不可伪造性

状态证明的有效性建立在环境的权威性之上。智能体无法自己宣布“我已完成”，完成状态是由受控环境（如受保护的 CI 环境或配置过 Git Hooks 的工作区）根据产物的实际状态计算得出的。这种“证明与执行分离”的架构是防止智能体产生幻觉的关键工程手段。无论智能体在对话中表现得多么自信，只要物理环境中的断言返回失败，系统就会强制其停留在当前执行阶段。
